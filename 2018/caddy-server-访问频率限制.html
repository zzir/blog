<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="zzir">
    <meta name="description" content="">
    <meta name="keywords" content="">
    
    <link rel="stylesheet" href="../css/style.css">
    
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Caveat&display=swap" rel="stylesheet" type="text/css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css">
    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.js"></script>
    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/contrib/auto-render.min.js"></script>
    
    <link rel="stylesheet" href="../css/github.css">
    <script src="../js/highlight.pack.js"></script>
    <title>Caddy Server 访问频率限制 - zzir</title>

    <script>
        hljs.initHighlightingOnLoad();
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ]
            });
        });
    </script>
</head>
<body>

    <main>
        <article>
            <h1 class="post-title">Caddy Server 访问频率限制</h1>
            <div class="post-info">
                <p class="post-date">Jul  8, 2018</p>
            </div>
            <div class="post-content">
                


  
  
  



<p>Caddy Server 访问频率限制，请求多次将返回 429 状态码。实现此功能需要安装 <code>http.ratelimit</code> 插件，可以在<a href="https://caddyserver.com/download" rel="nofollow">下载页</a>下载时选择此插件。</p>

<h2>举例</h2>

<h3>语法：</h3>

<pre><code>ratelimit methods path rate burst unit
...or...
ratelimit methods rate burst unit {
    whitelist CIDR
    resources
}
</code></pre>

<ul>
<li><code>methods</code> 请求方法，例如 get（多个方法 <code>,</code> 隔开，可以  <code>*</code> 表示所有方法）</li>
<li><code>path</code> 路径，例如 <code>/</code>、<code>/api</code></li>
<li><code>rate</code> 单位时间请求次数</li>
<li><code>burst</code> 客户端可超过的最大次数，不能小于单位时间请求次数</li>
<li><code>unit</code> 单位时间（当前支持：second，minute，hour，day，week）</li>
<li><code>whitelist</code> 白名单</li>
<li><code>resources</code> 目录或文件路径，每行一个</li>
</ul>

<h3>例如：</h3>

<p>单个资源：</p>

<pre><code class="language-conf">127.0.0.1:8080 {
    proxy / 10.10.0.222:8080
    gzip
    log /var/log/caddy/test.log
    ratelimit * / 1 1 second
    # 表示所有方法，所有路径，每秒最多请求1次
}
</code></pre>

<p>多个资源的表示：</p>

<pre><code class="language-conf">127.0.0.1:8080 {
    proxy / 10.10.0.222:8080
    gzip
    log /var/log/caddy/test.log
    ratelimit get,post 1 1 second {
        whitelist 127.0.0.1/32
        whitelist 10.10.0.0/16
        /api/
        ^/dist/path
    }
    # get、post方法
    # 每秒最多请求1次，白名单除外，路径 ^/dist/path 除外
    # 注意！想要限制 /api/，同时排除 ^/api/stats 不会生效
}
</code></pre>

<h2>参考</h2>

<p><a href="https://caddyserver.com/docs/http.ratelimit" rel="nofollow">https://caddyserver.com/docs/http.ratelimit</a><br/>
<a href="https://github.com/xuqingfeng/caddy-rate-limit" rel="nofollow">https://github.com/xuqingfeng/caddy-rate-limit</a></p>




            </div>
            <div class="post-info">
                <p class="post-tags">
                    
                        <a href="../tags/caddy">Caddy</a>
                    
                        <a href="../tags/ratelimit">ratelimit</a>
                    
                </p>
            </div>
        </article>
    </main>



    <footer>
        <p class="post-author">© <a href="/">zzir</a></p>
        <p class="foot-nav"><a href="/archives.html">Archive</a> | <a href="/about.html">About</a></p>
        <p class="beian">
            <span><img alt="zzir" src="/imgs/beian.png">浙公网安备33010902002287号</span>
            <span>浙ICP备19040093号</span>
        </p>
    </footer>



</body>
</html>
