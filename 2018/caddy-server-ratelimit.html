<!DOCTYPE html>
<html lang="zh"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="zzir">
    <meta name="description" content="The architect of civilization.">
    <meta name="keywords" content="zzir,Golang,Python,Docker,K8S">

    <link rel="stylesheet" href="/assets/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
          type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Caveat&display=swap" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css">
    <link rel="stylesheet" href="/assets/css/github.css">

    <title>Caddy Server è®¿é—®é¢‘ç‡é™åˆ¶ - ZZIR's Blog</title>
</head><body>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="post-back" id="post-back" style="display: none">
        <a class="black-link" href="https://zzir.cn">ğŸ™„</a>
    </div>
    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">
            Caddy Server è®¿é—®é¢‘ç‡é™åˆ¶
        </h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2018-07-08T00:00:00+08:00" itemprop="datePublished">Jul 8, 2018
            </time></p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
        <p>Caddy Server è®¿é—®é¢‘ç‡é™åˆ¶ï¼Œè¯·æ±‚å¤šæ¬¡å°†è¿”å› 429 çŠ¶æ€ç ã€‚å®ç°æ­¤åŠŸèƒ½éœ€è¦å®‰è£… <code class="highlighter-rouge">http.ratelimit</code> æ’ä»¶ï¼Œå¯ä»¥åœ¨<a href="https://caddyserver.com/download">ä¸‹è½½é¡µ</a>ä¸‹è½½æ—¶é€‰æ‹©æ­¤æ’ä»¶ã€‚</p>

<h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2>

<h3 id="è¯­æ³•">è¯­æ³•ï¼š</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ratelimit methods path rate burst unit
...or...
ratelimit methods rate burst unit {
    whitelist CIDR
    resources
}
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">methods</code> è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ getï¼ˆå¤šä¸ªæ–¹æ³• <code class="highlighter-rouge">,</code> éš”å¼€ï¼Œå¯ä»¥  <code class="highlighter-rouge">*</code> è¡¨ç¤ºæ‰€æœ‰æ–¹æ³•ï¼‰</li>
  <li><code class="highlighter-rouge">path</code> è·¯å¾„ï¼Œä¾‹å¦‚ <code class="highlighter-rouge">/</code>ã€<code class="highlighter-rouge">/api</code></li>
  <li><code class="highlighter-rouge">rate</code> å•ä½æ—¶é—´è¯·æ±‚æ¬¡æ•°</li>
  <li><code class="highlighter-rouge">burst</code> å®¢æˆ·ç«¯å¯è¶…è¿‡çš„æœ€å¤§æ¬¡æ•°ï¼Œä¸èƒ½å°äºå•ä½æ—¶é—´è¯·æ±‚æ¬¡æ•°</li>
  <li><code class="highlighter-rouge">unit</code> å•ä½æ—¶é—´ï¼ˆå½“å‰æ”¯æŒï¼šsecondï¼Œminuteï¼Œhourï¼Œdayï¼Œweekï¼‰</li>
  <li><code class="highlighter-rouge">whitelist</code> ç™½åå•</li>
  <li><code class="highlighter-rouge">resources</code> ç›®å½•æˆ–æ–‡ä»¶è·¯å¾„ï¼Œæ¯è¡Œä¸€ä¸ª</li>
</ul>

<!--more-->

<h3 id="ä¾‹å¦‚">ä¾‹å¦‚ï¼š</h3>
<p>å•ä¸ªèµ„æºï¼š</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">8080</span> {
    <span class="n">proxy</span> / <span class="m">10</span>.<span class="m">10</span>.<span class="m">0</span>.<span class="m">222</span>:<span class="m">8080</span>
    <span class="n">gzip</span>
    <span class="n">log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">caddy</span>/<span class="n">test</span>.<span class="n">log</span>
    <span class="n">ratelimit</span> * / <span class="m">1</span> <span class="m">1</span> <span class="n">second</span>
    <span class="c"># è¡¨ç¤ºæ‰€æœ‰æ–¹æ³•ï¼Œæ‰€æœ‰è·¯å¾„ï¼Œæ¯ç§’æœ€å¤šè¯·æ±‚1æ¬¡
</span>}
</code></pre></div></div>

<p>å¤šä¸ªèµ„æºçš„è¡¨ç¤ºï¼š</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">8080</span> {
    <span class="n">proxy</span> / <span class="m">10</span>.<span class="m">10</span>.<span class="m">0</span>.<span class="m">222</span>:<span class="m">8080</span>
    <span class="n">gzip</span>
    <span class="n">log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">caddy</span>/<span class="n">test</span>.<span class="n">log</span>
    <span class="n">ratelimit</span> <span class="n">get</span>,<span class="n">post</span> <span class="m">1</span> <span class="m">1</span> <span class="n">second</span> {
        <span class="n">whitelist</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>/<span class="m">32</span>
        <span class="n">whitelist</span> <span class="m">10</span>.<span class="m">10</span>.<span class="m">0</span>.<span class="m">0</span>/<span class="m">16</span>
        /<span class="n">api</span>/
        ^/<span class="n">dist</span>/<span class="n">path</span>
    }
    <span class="c"># getã€postæ–¹æ³•
</span>    <span class="c"># æ¯ç§’æœ€å¤šè¯·æ±‚1æ¬¡ï¼Œç™½åå•é™¤å¤–ï¼Œè·¯å¾„ ^/dist/path é™¤å¤–
</span>    <span class="c"># æ³¨æ„ï¼æƒ³è¦é™åˆ¶ /api/ï¼ŒåŒæ—¶æ’é™¤ ^/api/stats ä¸ä¼šç”Ÿæ•ˆ
</span>}
</code></pre></div></div>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p>https://caddyserver.com/docs/http.ratelimit  <br />
https://github.com/xuqingfeng/caddy-rate-limit</p>

    </div>

    <a class="u-url" href="/2018/caddy-server-ratelimit.html" hidden></a>
</article>

<div class="post-tags">
    
    <a>Caddy</a>
    
    <a>ratelimit</a>
    
</div>

<div class="pagination">
    <ul>
        
        <li class="prev">
            <a href="/2017/google-authentication.html" title="PREV: Google Authentication (2FA)">
                â€¹ Google Authentication (2FA)
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2018/bitcoin-blockchain.html" title="NEXT: Bitcoin åŒºå—å’Œäº¤æ˜“æ•°æ®ç»“æ„">
                â€º Bitcoin åŒºå—å’Œäº¤æ˜“æ•°æ®ç»“æ„
            </a>
        </li>
        
    </ul>
</div>
    </div>
</main><footer>
    <p class="post-author">Â© <a href="/">zzir</a></p>
    <p class="beian">
        
        <span>
            <img src="/assets/imgs/beian.png">
            <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010902002287">æµ™å…¬ç½‘å®‰å¤‡33010902002287å·</a>
        </span>
        ãƒ»ï¸
        <span><a href="http://beian.miit.gov.cn/">æµ™ICPå¤‡19040093å·</a></span>
        
    </p>
</footer>
<script defer src="/assets/js/katex/katex.min.js" type="text/javascript"></script>
<script defer src="/assets/js/katex/auto-render.min.js" type="text/javascript"></script>
<script src="/assets/js/zooming.min.js" type="text/javascript"></script>
<script src="/assets/js/highlight.pack.js" type="text/javascript"></script>
<script>
    // zooming
    const zooming = new Zooming({
        customSize: '100%',
    });
    zooming.listen('.paragraph img');
    zooming.listen('.content img');
    zooming.listen('.post-content img');

    // highlight
    hljs.initHighlightingOnLoad();

    // katex
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false},
                {left: "\\[", right: "\\]", display: true}
            ]
        });
    });

    // back display
    function getScrollTop() {
        var scrollTop = 0;
        if (document.documentElement && document.documentElement.scrollTop) {
            scrollTop = document.documentElement.scrollTop;
        } else if (document.body) {
            scrollTop = document.body.scrollTop;
        }
        return scrollTop;
    }

    window.onscroll = function () {
        if (getScrollTop() === 0) {
            document.getElementById("post-back").style.display = "block";
        }
    }
</script>


<script>
    // google analytics
    window.ga = window.ga || function () {
        (ga.q = ga.q || []).push(arguments)
    };
    ga.l = +new Date;
    ga('create', 'UA-121779014-1', 'auto');
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>
</html>