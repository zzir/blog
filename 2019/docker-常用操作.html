<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="zzir">
    <meta name="description" content="">
    <meta name="keywords" content="">
    
    <link rel="stylesheet" href="../css/style.css">
    
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Caveat&display=swap" rel="stylesheet" type="text/css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css">
    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.js"></script>
    <script defer src="https://cdn.staticfile.org/KaTeX/0.11.1/contrib/auto-render.min.js"></script>
    
    <link rel="stylesheet" href="../css/github.css">
    <script src="../js/highlight.pack.js"></script>
    <title>Docker 常用操作 - zzir</title>

    <script>
        hljs.initHighlightingOnLoad();
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ]
            });
        });
    </script>
</head>
<body>

    <main>
        <article>
            <h1 class="post-title">Docker 常用操作</h1>
            <div class="post-info">
                <p class="post-date">Oct 25, 2019</p>
            </div>
            <div class="post-content">
                


  
  
  



<blockquote>
<p>Build, share and run modern applications anywhere. -- Docker</p>
</blockquote>

<p>Docker 是一个针对开发者、架构师、DevOps 和 IT 的容器解决方案。</p>

<p>本篇主要记录日常开发中一些常用操作。</p>

<p>持续更新中，最后更新时间：2019/10/28。</p>

<h2>容器</h2>

<h3>启动一个容器并进入容器里</h3>

<pre><code class="language-bash">docker run -ti alpine:latest /bin/sh
</code></pre>

<p>常用参数解释：</p>

<ul>
<li><code>-t</code>: 伪终端模式</li>
<li><code>-i</code>: 打开标准输入</li>
<li><code>-d</code>: 后台运行</li>
<li><code>-p</code>: 映射端口</li>
<li><code>-v</code>: 挂载目录</li>
</ul>

<h3>创建一个容器但是不启动它</h3>

<pre><code class="language-bash">docker create --name test001 alpine:latest /bin/sh -c &#34;while true; do date; sleep 2; done&#34;
</code></pre>

<h3 id="启动-重启-删除一个容器">启动/重启/删除一个容器</h3>

<pre><code class="language-bash">docker start test001
docker restart test001
docker rm test001
</code></pre>

<p><em>注意：删除操作需要先将容器关闭</em></p>

<h3>进入容器内部</h3>

<pre><code class="language-bash">docker attach test001
</code></pre>

<h3>执行容器内的命令</h3>

<pre><code class="language-bash">docker exec -ti --user root test001 /bin/sh
</code></pre>

<p>参数解释：</p>

<ul>
<li><code>--user</code> 指定用户</li>
</ul>

<h3 id="宿主-容器相互拷贝">宿主/容器相互拷贝</h3>

<pre><code class="language-bash">docker cp test001:/etc/passwd /tmp/passwd
docker cp /tmp/passwd test001:/cat/passwd
</code></pre>

<h3 id="暂停-恢复一个容器">暂停/恢复一个容器</h3>

<pre><code class="language-bash">docker pause test001
docker unpause test001
</code></pre>

<p>可以使用 <code>docker logs -f test001</code> 验证其状态</p>

<h3 id="关闭-删除容器">关闭/删除容器</h3>

<pre><code class="language-bash">docker stop test001
</code></pre>

<p>或者直接 Kill 掉容器</p>

<pre><code class="language-bash">docker kill test001
</code></pre>

<p>等待容器结束并打印退出码</p>

<pre><code class="language-bash">docker wait test001
</code></pre>

<p>删除镜像</p>

<pre><code class="language-bash">docker rm test001
</code></pre>

<h3>列出运行中的容器</h3>

<pre><code class="language-bash">docker ps
</code></pre>

<p>可以加 <code>-a</code> 参数列出所有容器</p>

<h3 id="查看容器运行状况-cpu-mem-io-net等">查看容器运行状况(CPU/MEM/IO/NET等)</h3>

<pre><code class="language-bash">docker stats
</code></pre>

<h3>查看容器内进程状态</h3>

<pre><code class="language-bash">docker top test001
</code></pre>

<h3>查看容器端口信息</h3>

<pre><code class="language-bash">docker port test001
</code></pre>

<h3>查看容器日志信息</h3>

<pre><code class="language-bash">docker logs -f test001
</code></pre>

<p>参数解释：</p>

<ul>
<li><code>-f</code> 持续输出</li>
</ul>

<h3 id="查看容器-镜像元数据">查看容器/镜像元数据</h3>

<pre><code class="language-bash">docker inspect test001
</code></pre>

<h3>更改容器名称</h3>

<pre><code class="language-bash">docker rename test001 test111
docker rename test111 test001 # 将名称改回来
</code></pre>

<h3>查看容器文件更改</h3>

<pre><code class="language-bash">docker diff test001
</code></pre>

<h3>更改容器配置</h3>

<p><em>注意：不支持 Windows 系统</em></p>

<pre><code class="language-bash">docker run -dit --name test002 -m 100M alpine /bin/sh
docker update -m 80M test002
</code></pre>

<h3 id="导入-导出">导入/导出</h3>

<p>容器 (export/import)：</p>

<pre><code class="language-bash">docker export -o /tmp/test001-copy.tar test001 # 单个导出
docker import /tmp/test001-copy.tar test001-copy
docker images
</code></pre>

<p>镜像 (save/load)：</p>

<pre><code class="language-bash">docker save -o /tmp/test001-copy2.tar test001-copy:latest alpine:latest # 可多个镜像
docker load -i /tmp/test001-copy2.tar
</code></pre>

<p>区别：</p>

<ul>
<li><code>export</code> 针对容器，导出内容不包含中间层信息，适用于制作基础镜像</li>
<li><code>save</code> 针对镜像，可多个一起导出</li>
<li><code>import</code> 导入容器到镜像，可重新命名</li>
<li><code>load</code> 导入镜像，无法命名</li>
</ul>

<h2>镜像</h2>

<h3>查看镜像列表</h3>

<pre><code class="language-bash">docker images
</code></pre>

<h3>删除镜像</h3>

<pre><code class="language-bash">docker rmi test001-copy
</code></pre>

<p><em>注意：删除镜像需要依赖此镜像的容器都删除后才能操作</em></p>

<h3>给镜像打标签</h3>

<pre><code class="language-bash">docker tag alpine:latest my/alpine:latest
</code></pre>

<h3>镜像历史</h3>

<pre><code class="language-bash">docker history my/alpine:latest
</code></pre>

<h3>从容器创建一个新镜像</h3>

<pre><code class="language-bash">docker commit -p -a &#34;test&#34; -m &#34;test content&#34; test001 my/test002:latest
docker images | grep my/
</code></pre>

<p>参数说明:</p>

<ul>
<li><code>-p</code>: commit 时暂停</li>
<li><code>-a</code>: 提交镜像作者</li>
<li><code>-m</code>: 提交镜像说明</li>
<li><code>-c</code>: 使用 Dockerfile 创建</li>
</ul>

<h3>事件查看</h3>

<pre><code class="language-bash">docker events --filter &#39;container=test001&#39;
docker events --filter &#39;image=alpine&#39;
docker events --filter &#39;container=test&#39; --filter &#39;container=d9cdb1525ea8&#39;
docker events --filter &#39;type=volume&#39;
docker events --filter &#39;type=network&#39;
docker events --filter &#39;type=container&#39; --format &#39;Type={{.Type}}  Status={{.Status}}  ID={{.ID}}&#39;
</code></pre>

<p>全部以 JSON 输出</p>

<pre><code class="language-bash">docker events --format &#39;{{json .}}&#39;
</code></pre>

<p>更多自定义可以参考：<a href="https://docs.docker.com/engine/reference/commandline/events/" rel="nofollow">https://docs.docker.com/engine/reference/commandline/events/</a></p>

<h2>资源</h2>

<h3>列出所有数据卷</h3>

<pre><code class="language-bash">docker volume ls
</code></pre>

<h3 id="创建-删除数据卷">创建/删除数据卷</h3>

<pre><code class="language-bash">docker volume create test-volume
docker volume rm test-volume
</code></pre>

<h3>查看数据卷信息</h3>

<pre><code class="language-bash">docker volume inspect test-volume
</code></pre>

<h3>挂载数据卷</h3>

<pre><code class="language-bash">docker run -ti --name test003 --mount type=volume,source=test-volume,target=/data alpine /bin/sh
</code></pre>

<h3>挂载目录</h3>

<pre><code class="language-bash">docker run -ti --name test004 -v /tmp/docker/data:/data alpine /bin/sh
</code></pre>

<h3>网络列表</h3>

<pre><code class="language-bash">docker network ls
</code></pre>

<h3 id="创建-删除网络">创建/删除网络</h3>

<pre><code class="language-bash">docker network create -d bridge test-bridge
docker network rm test-bridge
</code></pre>

<h3>容器指定网络</h3>

<pre><code class="language-bash">docker run -ti --name test005 --network=test-bridge alpine /bin/sh
</code></pre>

<h3 id="容器设置-cpu-和内存限制">容器设置 CPU 和内存限制</h3>

<pre><code class="language-bash">docker run -ti --name test006 --cpus=1 -m 100M alpine /bin/sh
</code></pre>

<h2>插件</h2>

<h3>将数据卷通过存储到远程</h3>

<pre><code class="language-bash">docker plugin install --grant-all-permissions vieux/sshfs
docker volume create --driver vieux/sshfs -o sshcmd=test@192.168.5.242:/data/docker/sshvolume -o password=youpassword ssh-volume
docker run -ti --name test009 --mount type=volume,volume-driver=vieux/sshfs,source=ssh-volume,target=/data alpine /bin/sh
</code></pre>

<h2>其它</h2>

<h3>删除历史不使用的镜像</h3>

<pre><code class="language-bash">docker images | grep none | awk &#39;{ print $3; }&#39; | xargs docker rmi
</code></pre>

<h2>更多</h2>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/docker/" rel="nofollow">https://docs.docker.com/engine/reference/commandline/docker/</a></li>
</ul>




            </div>
            <div class="post-info">
                <p class="post-tags">
                    
                        <a href="../tags/docker">Docker</a>
                    
                </p>
            </div>
        </article>
    </main>



    <footer>
        <p class="post-author">© <a href="/">zzir</a></p>
        <p class="foot-nav"><a href="/archives.html">Archive</a> | <a href="/about.html">About</a></p>
        <p class="beian">
            <span><img alt="zzir" src="/imgs/beian.png">浙公网安备33010902002287号</span>
            <span>浙ICP备19040093号</span>
        </p>
    </footer>



</body>
</html>
